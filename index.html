<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Admin e-Murai</title>
</head>
<body>

<h2>Admin Panel e-Murai</h2>

<select id="sheet">
  <option>PENGUMUMAN</option>
  <option>IURAN BULANAN</option>
  <option>UANG KAS</option>
  <option>JADWAL RONDA</option>
</select>
<button onclick="loadData()">Load</button>

<table border="1">
  <thead id="thead"></thead>
  <tbody id="tbody"></tbody>
</table>

<button onclick="addRow()">Tambah Baris</button>

<script>
const API = "https://script.google.com/macros/s/AKfycbyxvcSvrKp1LYuBisVdyhNjlO5RmHfA16KreXE37MMPqc4_LYbhDsVPLPaUr4IrlXZX/exec";

async function loadData() {
  const sheet = document.getElementById("sheet").value;
  const res = await fetch(`${API}?sheet=${sheet}`);
  const data = await res.json();

  document.getElementById("thead").innerHTML =
    `<tr>${data.headers.map(h => `<th>${h}</th>`).join("")}<th>Aksi</th></tr>`;

  document.getElementById("tbody").innerHTML =
    data.rows.map(r => `
      <tr>
        ${data.headers.map(h =>
          `<td contenteditable onblur="save('${sheet}',${r._row})">${r[h] ?? ""}</td>`
        ).join("")}
        <td><button onclick="hapus('${sheet}',${r._row})">Hapus</button></td>
      </tr>
    `).join("");
}

async function save(sheet, row) {
  const cells = [...event.target.parentElement.children]
    .slice(0, -1)
    .map(td => td.innerText);

  await fetch(API, {
    method: "POST",
    body: JSON.stringify({
      action: "update",
      sheet,
      row,
      values: cells
    })
  });
}

async function hapus(sheet, row) {
  if (!confirm("Hapus baris ini?")) return;

  await fetch(API, {
    method: "POST",
    body: JSON.stringify({
      action: "delete",
      sheet,
      row
    })
  });

  loadData();
}

async function addRow() {
  const sheet = document.getElementById("sheet").value;
  const count = document.querySelectorAll("#thead th").length - 1;
  const values = Array(count).fill("");

  await fetch(API, {
    method: "POST",
    body: JSON.stringify({
      action: "create",
      sheet,
      values
    })
  });

  loadData();
}
</script>

</body>
</html>
