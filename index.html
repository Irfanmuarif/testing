<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
      body { padding: 20px; font-family: sans-serif; }
      .tab-content { margin-top: 20px; }
      .table-container { max-height: 300px; overflow-y: auto; }
    </style>
  </head>
  <body>
    <h3>Panel Admin Database RT</h3>
    
    <select id="sheetSelector" class="form-select mb-3" onchange="loadData()">
      <option value="PENGUMUMAN">PENGUMUMAN</option>
      <option value="IURAN BULANAN">IURAN BULANAN</option>
      <option value="UANG KAS">UANG KAS</option>
      <option value="JADWAL RONDA">JADWAL RONDA</option>
    </select>

    <div id="tableArea" class="table-container mb-3">
      <p class="text-muted">Pilih sheet untuk melihat data...</p>
    </div>

    <hr>
    <h5>Tambah Data Baru</h5>
    <div id="formInput" class="row g-2">
      </div>
    <button class="btn btn-primary mt-3" onclick="submitData()">Simpan Data</button>

    <script>
      let currentHeaders = [];

      function loadData() {
        const sheetName = document.getElementById('sheetSelector').value;
        google.script.run.withSuccessHandler(displayTable).getDataFromSheet(sheetName);
      }

      function displayTable(data) {
        const container = document.getElementById('tableArea');
        const formInput = document.getElementById('formInput');
        currentHeaders = data[0];
        
        // Buat Tabel
        let html = '<table class="table table-sm table-bordered"><thead><tr>';
        currentHeaders.forEach(h => html += `<th>${h}</th>`);
        html += '<th>Aksi</th></tr></thead><tbody>';

        for (let i = 1; i < data.length; i++) {
          html += '<tr>';
          data[i].forEach(cell => html += `<td>${cell}</td>`);
          html += `<td><button class="btn btn-danger btn-sm" onclick="deleteRow(${i})">Hapus</button></td>`;
          html += '</tr>';
        }
        html += '</tbody></table>';
        container.innerHTML = html;

        // Buat Form Input Otomatis
        let formHtml = '';
        currentHeaders.forEach((h, index) => {
          formHtml += `<div class="col-md-4"><label class="small">${h}</label>
                       <input type="text" id="input_${index}" class="form-control form-control-sm"></div>`;
        });
        formInput.innerHTML = formHtml;
      }

      function submitData() {
        const sheetName = document.getElementById('sheetSelector').value;
        let rowData = [];
        currentHeaders.forEach((_, i) => {
          rowData.push(document.getElementById(`input_${i}`).value);
        });

        google.script.run.withSuccessHandler(() => {
          alert('Data Berhasil Ditambah!');
          loadData();
        }).addRowToSheet(sheetName, rowData);
      }

      function deleteRow(index) {
        if(confirm('Yakin ingin menghapus baris ini?')) {
          const sheetName = document.getElementById('sheetSelector').value;
          google.script.run.withSuccessHandler(() => {
            loadData();
          }).deleteRowFromSheet(sheetName, index);
        }
      }

      window.onload = loadData;
    </script>
  </body>
</html>
